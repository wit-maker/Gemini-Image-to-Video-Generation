name: module-create-summary

on:
  workflow_call:
    inputs:
      concept:
        description: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆ'
        required: true
        type: string
      branch-name:
        description: 'ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ–ãƒ©ãƒ³ãƒå'
        required: true
        type: string
      folder-name:
        description: 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€å'
        required: true
        type: string
    secrets:
      github_pat:
        description: 'GitHub Token'
        required: true

jobs:
  create-summary:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.branch-name }}
          
      - name: Create summary
        run: |
          FOLDER_NAME="${{ inputs.folder-name }}"
          cat > "$FOLDER_NAME/README.md" << EOF
          # Gemini Image-to-Video Generation & Analysis Results
          
          ## Overview
          - **Base Concept**: ${{ inputs.concept }}
          - **Generated At**: $(date)
          - **Branch**: ${{ inputs.branch-name }}
          
          ## Generated Content
          - **Planning**: \`planning/\` directory
          - **Image**: \`images/image.png\`
          - **Video**: \`videos/video.mp4\`
          - **Analysis**: \`analysis/video-analysis.md\`
          
          ## Generation Pipeline
          1. âœ… Planning: Image & Video prompt optimization
          2. âœ… Image Generation: Imagen4 Fast
          3. âœ… Video Generation: Hailuo-02 Pro (I2V)
          4. âœ… Video Analysis: Gemini Vision
          
          ---
          ğŸ¤– Generated with [Claude Code](https://claude.ai/code)
          EOF
          
      - name: Commit summary
        env:
          GH_TOKEN: ${{ secrets.github_pat }}
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          if git diff --cached --quiet; then
            echo "No summary files to commit"
          else
            git commit -m "ğŸ“ Add workflow summary: ${{ inputs.concept }}
            
            ğŸ¤– Generated with [Claude Code](https://claude.ai/code)
            
            Co-Authored-By: Claude <noreply@anthropic.com>"
            # ãƒªãƒ™ãƒ¼ã‚¹ã—ã¦ã‹ã‚‰ãƒ—ãƒƒã‚·ãƒ¥ï¼ˆä¸¦åˆ—å®Ÿè¡Œã§ã®ç«¶åˆã‚’å›é¿ï¼‰
            git pull --rebase origin ${{ inputs.branch-name }} || true
            git push origin ${{ inputs.branch-name }}
          fi