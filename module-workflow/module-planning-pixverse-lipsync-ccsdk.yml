name: module-planning-pixverse-lipsync-ccsdk

on:
  workflow_call:
    inputs:
      concept:
        description: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆ'
        required: true
        type: string
      branch-name:
        description: 'ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ–ãƒ©ãƒ³ãƒå'
        required: true
        type: string
      folder-name:
        description: 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€å'
        required: true
        type: string
      video-model:
        description: 'I2Vå‹•ç”»ç”Ÿæˆãƒ¢ãƒ‡ãƒ«'
        required: false
        type: string
        default: 'i2v-fal-hailuo-02-pro'
      audio-model:
        description: 'éŸ³å£°ç”Ÿæˆãƒ¢ãƒ‡ãƒ«'
        required: false
        type: string
        default: 't2s-fal-minimax-speech-02-turbo'
    outputs:
      planning-completed:
        description: 'ä¼ç”»å®Œäº†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹'
        value: ${{ jobs.planning.outputs.planning-completed }}
      segment-matrix:
        description: 'ãƒãƒˆãƒªãƒƒã‚¯ã‚¹æˆ¦ç•¥ç”¨ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé…åˆ—'
        value: ${{ jobs.planning.outputs.segment-matrix }}
      total-segments:
        description: 'ãƒ—ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ã§æ±ºå®šã•ã‚ŒãŸã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°'
        value: ${{ jobs.planning.outputs.total-segments }}
      # ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç”¨å‡ºåŠ›ï¼ˆæœ€å¤§8ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã¾ã§å¯¾å¿œï¼‰
      image-prompt-1:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ1ç”¨ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.image-prompt-1 }}
      image-prompt-2:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ2ç”¨ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.image-prompt-2 }}
      image-prompt-3:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ3ç”¨ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.image-prompt-3 }}
      image-prompt-4:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ4ç”¨ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.image-prompt-4 }}
      image-prompt-5:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ5ç”¨ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.image-prompt-5 }}
      image-prompt-6:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ6ç”¨ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.image-prompt-6 }}
      image-prompt-7:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ7ç”¨ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.image-prompt-7 }}
      image-prompt-8:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ8ç”¨ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.image-prompt-8 }}
      video-concept-1:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ1ç”¨å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.video-concept-1 }}
      video-concept-2:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ2ç”¨å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.video-concept-2 }}
      video-concept-3:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ3ç”¨å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.video-concept-3 }}
      video-concept-4:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ4ç”¨å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.video-concept-4 }}
      video-concept-5:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ5ç”¨å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.video-concept-5 }}
      video-concept-6:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ6ç”¨å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.video-concept-6 }}
      video-concept-7:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ7ç”¨å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.video-concept-7 }}
      video-concept-8:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ8ç”¨å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.video-concept-8 }}
      audio-script-1:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ1ç”¨éŸ³å£°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.audio-script-1 }}
      audio-script-2:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ2ç”¨éŸ³å£°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.audio-script-2 }}
      audio-script-3:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ3ç”¨éŸ³å£°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.audio-script-3 }}
      audio-script-4:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ4ç”¨éŸ³å£°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.audio-script-4 }}
      audio-script-5:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ5ç”¨éŸ³å£°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.audio-script-5 }}
      audio-script-6:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ6ç”¨éŸ³å£°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.audio-script-6 }}
      audio-script-7:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ7ç”¨éŸ³å£°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.audio-script-7 }}
      audio-script-8:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ8ç”¨éŸ³å£°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ'
        value: ${{ jobs.planning.outputs.audio-script-8 }}
      # éŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šï¼ˆMiniMax Voice Designç”¨ï¼‰
      voice-character-1:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ1ç”¨éŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š'
        value: ${{ jobs.planning.outputs.voice-character-1 }}
      voice-character-2:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ2ç”¨éŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š'
        value: ${{ jobs.planning.outputs.voice-character-2 }}
      voice-character-3:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ3ç”¨éŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š'
        value: ${{ jobs.planning.outputs.voice-character-3 }}
      voice-character-4:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ4ç”¨éŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š'
        value: ${{ jobs.planning.outputs.voice-character-4 }}
      voice-character-5:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ5ç”¨éŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š'
        value: ${{ jobs.planning.outputs.voice-character-5 }}
      voice-character-6:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ6ç”¨éŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š'
        value: ${{ jobs.planning.outputs.voice-character-6 }}
      voice-character-7:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ7ç”¨éŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š'
        value: ${{ jobs.planning.outputs.voice-character-7 }}
      voice-character-8:
        description: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ8ç”¨éŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š'
        value: ${{ jobs.planning.outputs.voice-character-8 }}
    secrets:
      anthropic_api_key:
        description: 'Anthropic API Key'
        required: true
      github_pat:
        description: 'GitHub Token'
        required: true

jobs:
  planning:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    outputs:
      planning-completed: ${{ steps.planning.outputs.completed }}
      segment-matrix: ${{ steps.planning.outputs.segment-matrix }}
      total-segments: ${{ steps.planning.outputs.total-segments }}
      # ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç”¨å‡ºåŠ›ï¼ˆæœ€å¤§8ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã¾ã§å¯¾å¿œï¼‰
      image-prompt-1: ${{ steps.planning.outputs.image-prompt-1 }}
      image-prompt-2: ${{ steps.planning.outputs.image-prompt-2 }}
      image-prompt-3: ${{ steps.planning.outputs.image-prompt-3 }}
      image-prompt-4: ${{ steps.planning.outputs.image-prompt-4 }}
      image-prompt-5: ${{ steps.planning.outputs.image-prompt-5 }}
      image-prompt-6: ${{ steps.planning.outputs.image-prompt-6 }}
      image-prompt-7: ${{ steps.planning.outputs.image-prompt-7 }}
      image-prompt-8: ${{ steps.planning.outputs.image-prompt-8 }}
      video-concept-1: ${{ steps.planning.outputs.video-concept-1 }}
      video-concept-2: ${{ steps.planning.outputs.video-concept-2 }}
      video-concept-3: ${{ steps.planning.outputs.video-concept-3 }}
      video-concept-4: ${{ steps.planning.outputs.video-concept-4 }}
      video-concept-5: ${{ steps.planning.outputs.video-concept-5 }}
      video-concept-6: ${{ steps.planning.outputs.video-concept-6 }}
      video-concept-7: ${{ steps.planning.outputs.video-concept-7 }}
      video-concept-8: ${{ steps.planning.outputs.video-concept-8 }}
      audio-script-1: ${{ steps.planning.outputs.audio-script-1 }}
      audio-script-2: ${{ steps.planning.outputs.audio-script-2 }}
      audio-script-3: ${{ steps.planning.outputs.audio-script-3 }}
      audio-script-4: ${{ steps.planning.outputs.audio-script-4 }}
      audio-script-5: ${{ steps.planning.outputs.audio-script-5 }}
      audio-script-6: ${{ steps.planning.outputs.audio-script-6 }}
      audio-script-7: ${{ steps.planning.outputs.audio-script-7 }}
      audio-script-8: ${{ steps.planning.outputs.audio-script-8 }}
      # éŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šï¼ˆMiniMax Voice Designç”¨ï¼‰
      voice-character-1: ${{ steps.planning.outputs.voice-character-1 }}
      voice-character-2: ${{ steps.planning.outputs.voice-character-2 }}
      voice-character-3: ${{ steps.planning.outputs.voice-character-3 }}
      voice-character-4: ${{ steps.planning.outputs.voice-character-4 }}
      voice-character-5: ${{ steps.planning.outputs.voice-character-5 }}
      voice-character-6: ${{ steps.planning.outputs.voice-character-6 }}
      voice-character-7: ${{ steps.planning.outputs.voice-character-7 }}
      voice-character-8: ${{ steps.planning.outputs.voice-character-8 }}
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.branch-name }}
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Claude Code SDK
        run: npm install @anthropic-ai/claude-code
      
      - name: Pixverseãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯åˆ¶ä½œè¨ˆç”»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
        id: planning
        env:
          ANTHROPIC_API_KEY: ${{ secrets.anthropic_api_key }}
        run: |
          echo "::group::ğŸ¬ Pixverse Lipsync Planning Agent Execution"
          echo "Starting at: $(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)"
          
          # è¨­å®š
          USER_CONCEPT="${{ inputs.concept }}"
          FOLDER_NAME="${{ inputs.folder-name }}"
          PLANNING_DIR="$FOLDER_NAME/planning"
          VIDEO_MODEL="${{ inputs.video-model }}"
          AUDIO_MODEL="${{ inputs.audio-model }}"
          
          echo "User concept: $USER_CONCEPT"
          echo "Planning folder: $PLANNING_DIR"
          echo "Video model: $VIDEO_MODEL"
          echo "Audio model: $AUDIO_MODEL"
          
          # ä¼ç”»ãƒ•ã‚©ãƒ«ãƒ€ã‚’äº‹å‰ã«ä½œæˆ
          if [ ! -d "$PLANNING_DIR" ]; then
            mkdir -p "$PLANNING_DIR"
            echo "ğŸ“ Created planning folder: $PLANNING_DIR"
          fi
          
          # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ§‹ç¯‰
          PROMPT="ã‚ãªãŸã¯Pixverseãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯å‹•ç”»åˆ¶ä½œã®å°‚é–€ä¼ç”»è€…ã§ã™ã€‚Pixverseã®æŠ€è¡“åˆ¶é™ï¼ˆå‹•ç”»5MBä»¥ä¸‹ã€éŸ³å£°30ç§’ä»¥å†…ï¼‰ã‚’è€ƒæ…®ã—ã¦ã€åŠ¹æœçš„ãªãƒãƒ«ãƒã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ§‹æˆã‚’ä¼ç”»ã—ã¦ãã ã•ã„ã€‚

          **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦æ±‚**: $USER_CONCEPT
          **æŠ€è¡“ä»•æ§˜**:
          - **å‹•ç”»ç”Ÿæˆãƒ¢ãƒ‡ãƒ«**: $VIDEO_MODEL
          - **éŸ³å£°ç”Ÿæˆãƒ¢ãƒ‡ãƒ«**: $AUDIO_MODEL
          - **Pixverseåˆ¶é™**: 
            - å‹•ç”»: 5MBä»¥ä¸‹ï¼ˆç´„10-15ç§’ã®çŸ­æ™‚é–“å‹•ç”»æ¨å¥¨ï¼‰
            - éŸ³å£°: 30ç§’ä»¥å†…ï¼ˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚ãŸã‚Š20-25ç§’æ¨å¥¨ï¼‰

          **é‡è¦ãªä¼ç”»ã‚¿ã‚¹ã‚¯**:
          1. **ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°ã®å›ºå®š**:
             - **ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°ã¯1å€‹ã«å›ºå®š**ï¼ˆã‚·ãƒ³ãƒ—ãƒ«å®Ÿè£…ï¼‰
             - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆå…¨ä½“ã‚’1ã¤ã®é«˜å“è³ªå‹•ç”»ã¨ã—ã¦è¡¨ç¾
             - Pixverseåˆ¶é™å†…ã§æœ€é«˜å“è³ªã‚’å®Ÿç¾

          2. **ä¼ç”»è¨­è¨ˆæ–¹é‡**:
             - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’1ã¤ã®å®Œçµã—ãŸå‹•ç”»ã¨ã—ã¦ä¼ç”»
             - åˆ¶é™å†…ã§æœ€å¤§ã®è¡¨ç¾åŠ›ã‚’ç™ºæ®ã™ã‚‹æ§‹æˆ
             - ã‚·ãƒ³ãƒ—ãƒ«ã§æ´—ç·´ã•ã‚ŒãŸé«˜å“è³ªã‚³ãƒ³ãƒ†ãƒ³ãƒ„

          3. **åˆ¶é™å†…æœ€é©åŒ–**:
             - å„å‹•ç”»ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ: 10-15ç§’ç¨‹åº¦ï¼ˆ5MBåˆ¶é™å¯¾å¿œï¼‰
             - å„éŸ³å£°ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ: 20-25ç§’ç¨‹åº¦ï¼ˆ30ç§’åˆ¶é™å¯¾å¿œï¼‰
             - é«˜ç”»è³ªç¶­æŒã®ãŸã‚çŸ­æ™‚é–“é›†ç´„

          4. **ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯å“è³ªå‘ä¸Š**:
             - æ˜ç­ãªç™ºè©±å†…å®¹ã¨å£ã®å‹•ãã®åŒæœŸã‚’é‡è¦–
             - éŸ³å£°ã®æ˜ç­æ€§ã¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è€ƒæ…®ã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆ
             - é¡”ãŒã¯ã£ãã‚Šè¦‹ãˆã‚‹æ§‹å›³ã®å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

          **å…·ä½“çš„ã‚¿ã‚¹ã‚¯**:

          **STEP 1: ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°ã®å›ºå®šè¨­å®š**:
          ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°ã‚’1å€‹ã«å›ºå®šã—ã¦ä¼ç”»ã—ã¦ãã ã•ã„ï¼š
          
          **å³æ ¼ãªåˆ¶é™éµå®ˆãƒ«ãƒ¼ãƒ«**:
          - **å‹•ç”»åˆ¶é™**: æœ€å¤§5MBï¼ˆå®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ã§4.5MBä»¥ä¸‹ã‚’ç›®æ¨™ï¼‰
          - **éŸ³å£°åˆ¶é™**: æœ€å¤§30ç§’ï¼ˆå®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ã§25ç§’ä»¥ä¸‹ã‚’ç›®æ¨™ï¼‰
          - **å‹•ç”»é•·**: 10-12ç§’ã®å‹•ç”»ã‚’æ¨å¥¨ï¼ˆçŸ­ã™ããšã€åˆ¶é™å†…ç¢ºå®Ÿï¼‰
          - **éŸ³å£°é•·**: 20-22ç§’ã®éŸ³å£°ã‚’æ¨å¥¨ï¼ˆè‡ªç„¶ãªç™ºè©±é€Ÿåº¦ã§åˆ¶é™å†…ç¢ºå®Ÿï¼‰
          
          **ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°å›ºå®šè¨­å®š**:
          1. **TOTAL_SEGMENTS=1**ã«å›ºå®š
          2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ³ã‚»ãƒ—ãƒˆå…¨ä½“ã‚’1ã¤ã®å‹•ç”»ã¨ã—ã¦è¡¨ç¾
          3. åˆ¶é™å†…ã§æœ€é«˜å“è³ªã‚’å®Ÿç¾ã™ã‚‹å†…å®¹ã«é›†ç´„
          4. **é‡è¦**: ã‚·ãƒ³ãƒ—ãƒ«ã§æ´—ç·´ã•ã‚ŒãŸ1æœ¬ã®å®Œæˆåº¦ã®é«˜ã„å‹•ç”»ã‚’ç›®æŒ‡ã™

          **STEP 2: å…¨ä½“æ§‹æˆè¨ˆç”»æ›¸ã®ä½œæˆ**:
             \`\`\`bash
             # ãƒ¡ã‚¤ãƒ³ä¼ç”»æ›¸ã‚’ä½œæˆ
             echo \"# Pixverseãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯å‹•ç”»åˆ¶ä½œä¼ç”»\" > \"$PLANNING_DIR/pixverse-lipsync-plan.md\"
             echo \"## å…¨ä½“ã‚³ãƒ³ã‚»ãƒ—ãƒˆ\" >> \"$PLANNING_DIR/pixverse-lipsync-plan.md\"
             echo \"$USER_CONCEPT\" >> \"$PLANNING_DIR/pixverse-lipsync-plan.md\"
             echo \"## ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°: 1å€‹ï¼ˆã‚·ãƒ³ã‚°ãƒ«å®Ÿè£…ï¼‰\" >> \"$PLANNING_DIR/pixverse-lipsync-plan.md\"
             echo \"[ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ³ã‚»ãƒ—ãƒˆå…¨ä½“ã‚’1ã¤ã®é«˜å“è³ªå‹•ç”»ã¨ã—ã¦è¡¨ç¾]\" >> \"$PLANNING_DIR/pixverse-lipsync-plan.md\"
             echo \"## æŠ€è¡“åˆ¶ç´„å¯¾å¿œ\" >> \"$PLANNING_DIR/pixverse-lipsync-plan.md\"
             echo \"- å‹•ç”»åˆ¶é™: 5MBä»¥ä¸‹ï¼ˆ10-12ç§’æ¨å¥¨ï¼‰\" >> \"$PLANNING_DIR/pixverse-lipsync-plan.md\"
             echo \"- éŸ³å£°åˆ¶é™: 30ç§’ä»¥å†…ï¼ˆ20-22ç§’æ¨å¥¨ï¼‰\" >> \"$PLANNING_DIR/pixverse-lipsync-plan.md\"
             echo \"- ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯æœ€é©åŒ–: é¡”ãŒæ˜ç¢ºã«è¦‹ãˆã‚‹æ§‹å›³\" >> \"$PLANNING_DIR/pixverse-lipsync-plan.md\"
             echo \"## æœ€çµ‚å‹•ç”»ã®æƒ³å®šé•·ã•\" >> \"$PLANNING_DIR/pixverse-lipsync-plan.md\"
             echo \"10-12ç§’ã®é«˜å“è³ªå‹•ç”»1æœ¬\" >> \"$PLANNING_DIR/pixverse-lipsync-plan.md\"
             
             # ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°ã‚’1ã«å›ºå®š
             TOTAL_SEGMENTS=1
             echo \"1\" > \"$PLANNING_DIR/total-segments.txt\"
             \`\`\`

          **STEP 3: å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä½œæˆ**:
             æ±ºå®šã•ã‚ŒãŸã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°ï¼ˆ\$TOTAL_SEGMENTSï¼‰ã«åŸºã¥ã„ã¦ã€é«˜å“è³ªãªç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½œæˆï¼š
             \`\`\`bash
             # å‹•çš„ã«ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°åˆ†ã®ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½œæˆ
             for i in \$(seq 1 \$TOTAL_SEGMENTS); do
               echo \"[ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ\$i: High-quality portrait for video generation, clear facial features, professional lighting, suitable for I2V animation]\" > \"$PLANNING_DIR/image-prompt-\$i.txt\"
             done
             \`\`\`

          **STEP 4: å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆä½œæˆ**:
             æ±ºå®šã•ã‚ŒãŸã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°ï¼ˆ\$TOTAL_SEGMENTSï¼‰ã«åŸºã¥ã„ã¦ã€åˆ¶é™éµå®ˆã‚’ä¿è¨¼ã™ã‚‹å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’ä½œæˆï¼š
             \`\`\`bash
             # å‹•çš„ã«ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°åˆ†ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼ˆåˆ¶é™éµå®ˆä¿è¨¼ï¼‰
             for i in \$(seq 1 \$TOTAL_SEGMENTS); do
               echo \"[ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ\$i: 10-12ç§’ä»¥å†…ã§å®Œçµã™ã‚‹å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€ã‚·ãƒ³ãƒ—ãƒ«ã§é«˜å“è³ªã€é¡”ãŒã‚¯ãƒªã‚¢ã«è¦‹ãˆã‚‹æ§‹å›³ã€5MBåˆ¶é™ç¢ºå®Ÿéµå®ˆ]\" > \"$PLANNING_DIR/video-concept-\$i.txt\"
             done
             \`\`\`

          **STEP 5: å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®éŸ³å£°ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ**:
             æ±ºå®šã•ã‚ŒãŸã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°ï¼ˆ\$TOTAL_SEGMENTSï¼‰ã«åŸºã¥ã„ã¦ã€åˆ¶é™éµå®ˆã‚’ä¿è¨¼ã™ã‚‹éŸ³å£°ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆï¼š
             \`\`\`bash
             # å‹•çš„ã«ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°åˆ†ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼ˆåˆ¶é™éµå®ˆä¿è¨¼ï¼‰
             for i in \$(seq 1 \$TOTAL_SEGMENTS); do
               echo \"[ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ\$i: 20-22ç§’ä»¥å†…ï¼ˆæ¨™æº–èª­ã¿ä¸Šã’é€Ÿåº¦ï¼‰ã§èª­ã‚ã‚‹æ—¥æœ¬èªã‚¹ã‚¯ãƒªãƒ—ãƒˆã€30ç§’åˆ¶é™ç¢ºå®Ÿéµå®ˆã€ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯æœ€é©åŒ–]\" > \"$PLANNING_DIR/audio-script-\$i.txt\"
             done
             \`\`\`

          **STEP 5.5: å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®éŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šä½œæˆï¼ˆMiniMax Voice Designç”¨ï¼‰**:
             æ±ºå®šã•ã‚ŒãŸã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°ï¼ˆ\$TOTAL_SEGMENTSï¼‰ã«åŸºã¥ã„ã¦ã€è‡ªç„¶è¨€èªå½¢å¼ã®éŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’ä½œæˆï¼š
             \`\`\`bash
             # å‹•çš„ã«ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°åˆ†ã®éŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
             for i in \$(seq 1 \$TOTAL_SEGMENTS); do
               echo \"[ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ\$iç”¨éŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼: æ—¥æœ¬èªã«é©ã—ãŸè‡ªç„¶ã§é­…åŠ›çš„ãªå¥³æ€§ã®å£°ã€æ„Ÿæƒ…è±Šã‹ã§è¦ªã—ã¿ã‚„ã™ãæ¸©ã‹ã¿ãŒã‚ã‚‹ã€ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ã«æœ€é©åŒ–ã•ã‚ŒãŸæ˜ç­ã§ç¾ã—ã„ç™ºéŸ³ã€è‹¥ã€…ã—ãã‚¨ãƒãƒ«ã‚®ãƒƒã‚·ãƒ¥ã§èãæ‰‹ã‚’æƒ¹ãã¤ã‘ã‚‹é­…åŠ›çš„ãªå£°è³ª]\" > \"$PLANNING_DIR/voice-character-\$i.txt\"
             done
             \`\`\`

          **STEP 6: åˆ¶é™éµå®ˆæ¤œè¨¼**:
             \`\`\`bash
             # åˆ¶é™éµå®ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ä½œæˆ
             echo \"# Pixverseåˆ¶é™éµå®ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ\" > \"$PLANNING_DIR/constraint-verification.md\"
             echo \"## å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®åˆ¶é™ãƒã‚§ãƒƒã‚¯\" >> \"$PLANNING_DIR/constraint-verification.md\"
             for i in \$(seq 1 \$TOTAL_SEGMENTS); do
               echo \"### ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ\$i\" >> \"$PLANNING_DIR/constraint-verification.md\"
               echo \"- [ ] å‹•ç”»é•·: 10-12ç§’ï¼ˆ5MBåˆ¶é™å†…ç¢ºå®Ÿï¼‰\" >> \"$PLANNING_DIR/constraint-verification.md\"
               echo \"- [ ] éŸ³å£°é•·: 20-22ç§’ï¼ˆ30ç§’åˆ¶é™å†…ç¢ºå®Ÿï¼‰\" >> \"$PLANNING_DIR/constraint-verification.md\"
               echo \"- [ ] ã‚³ãƒ³ãƒ†ãƒ³ãƒ„: ã‚·ãƒ³ãƒ—ãƒ«ã§é«˜å“è³ª\" >> \"$PLANNING_DIR/constraint-verification.md\"
               echo \"\" >> \"$PLANNING_DIR/constraint-verification.md\"
             done
             echo \"## å…¨ä½“æ¤œè¨¼\" >> \"$PLANNING_DIR/constraint-verification.md\"
             echo \"- [ ] å…¨ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãŒPixverseåˆ¶é™å†…\" >> \"$PLANNING_DIR/constraint-verification.md\"
             echo \"- [ ] å®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ç¢ºä¿ï¼ˆå‹•ç”»4.5MBä»¥ä¸‹ã€éŸ³å£°25ç§’ä»¥ä¸‹ç›®æ¨™ï¼‰\" >> \"$PLANNING_DIR/constraint-verification.md\"
             \`\`\`

          **å³æ ¼ãªå“è³ªåŸºæº–**:
          - **å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆ**: 10-12ç§’ã§å®Œçµï¼ˆ5MBåˆ¶é™ç¢ºå®Ÿéµå®ˆï¼‰ã€ã‚·ãƒ³ãƒ—ãƒ«æ§‹å›³ã€é¡”è¡¨æƒ…é‡è¦–
          - **éŸ³å£°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: 20-22ç§’ã§èª­ã¿åˆ‡ã‚Šï¼ˆ30ç§’åˆ¶é™ç¢ºå®Ÿéµå®ˆï¼‰ã€è‡ªç„¶ãªæ—¥æœ¬èªã€æ˜ç­ç™ºéŸ³
          - **åˆ¶é™éµå®ˆ**: å…¨ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã§å®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ç¢ºä¿ï¼ˆå‹•ç”»4.5MBä»¥ä¸‹ã€éŸ³å£°25ç§’ä»¥ä¸‹ç›®æ¨™ï¼‰
          - **ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯é©æ€§**: å£ã®å‹•ãã¨éŸ³å£°ã®å®Œç’§åŒæœŸã‚’æœ€å„ªå…ˆ

          **çµ¶å¯¾éµå®ˆäº‹é …**:
          - **å¿…é ˆ**: Pixverseåˆ¶é™ã‚’çµ¶å¯¾ã«è¶…ãˆãªã„ï¼ˆå‹•ç”»5MBã€éŸ³å£°30ç§’ï¼‰
          - **æ¨å¥¨**: å®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ã‚’å¿…ãšç¢ºä¿ï¼ˆå‹•ç”»4.5MBä»¥ä¸‹ã€éŸ³å£°25ç§’ä»¥ä¸‹ï¼‰
          - **åŸå‰‡**: è¿·ã£ãŸå ´åˆã¯åˆ¶é™éµå®ˆã‚’æœ€å„ªå…ˆï¼ˆå“è³ªã‚ˆã‚Šåˆ¶ç´„å„ªå…ˆï¼‰
          - **æ¤œè¨¼**: å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®åˆ¶é™ãƒã‚§ãƒƒã‚¯ã‚’å¿…ãšå®Ÿæ–½

          **å¿…é ˆå‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«**:
          1. pixverse-lipsync-plan.md - å…¨ä½“ä¼ç”»æ›¸ï¼ˆåˆ¶é™éµå®ˆè¨ˆç”»å«ã‚€ï¼‰
          2. total-segments.txt - æ±ºå®šã•ã‚ŒãŸã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°
          3. image-prompt-[1-N].txt - å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆè‹±èªã€é«˜å“è³ªï¼‰
          4. video-concept-[1-N].txt - å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆï¼ˆåˆ¶é™éµå®ˆä¿è¨¼ï¼‰
          5. audio-script-[1-N].txt - å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®éŸ³å£°ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆåˆ¶é™éµå®ˆä¿è¨¼ï¼‰
          6. voice-character-[1-N].txt - å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®éŸ³å£°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šï¼ˆMiniMax Voice Designç”¨ã€è‡ªç„¶è¨€èªå½¢å¼ï¼‰
          7. constraint-verification.md - åˆ¶é™éµå®ˆæ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

          **åˆ¶é™éµå®ˆä¿è¨¼ãƒ—ãƒ­ã‚»ã‚¹**: 
          1. **åˆ†æ**: ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’è©³ç´°åˆ†æã—ã€Pixverseåˆ¶é™å†…ã§å®Ÿç¾å¯èƒ½ãªã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°ã‚’æ±ºå®š
          2. **è¨­è¨ˆ**: å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãŒç¢ºå®Ÿã«åˆ¶é™å†…ã«åã¾ã‚‹ã‚ˆã†å®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ä»˜ãã§è¨­è¨ˆ
          3. **æ¤œè¨¼**: åˆ¶é™éµå®ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã§å…¨ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’æ¤œè¨¼
          4. **å‡ºåŠ›**: åˆ¶é™éµå®ˆã‚’ä¿è¨¼ã—ãŸä¼ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’GitHub Outputsã«å‡ºåŠ›

          **T2Iç”»åƒç”Ÿæˆè¦ä»¶**:
          - å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç”¨ã®é«˜å“è³ªç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½œæˆ
          - è‹±èªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§è©³ç´°ãªè¦–è¦šçš„æå†™ã‚’è¨˜è¿°
          - ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯å‹•ç”»ã«é©ã—ãŸäººç‰©ã®é¡”ãŒã‚¯ãƒªã‚¢ã«è¦‹ãˆã‚‹ç”»åƒã‚’ç”Ÿæˆ
          - I2Vå‹•ç”»ç”Ÿæˆã«æœ€é©åŒ–ã•ã‚ŒãŸæ§‹å›³ã¨ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°ã‚’æŒ‡å®š
          
          **æœ€é‡è¦**: Pixverseåˆ¶é™ï¼ˆå‹•ç”»5MBã€éŸ³å£°30ç§’ï¼‰ã‚’çµ¶å¯¾ã«è¶…ãˆãªã„ã“ã¨ã‚’æœ€å„ªå…ˆã¨ã—ã¦ä¼ç”»ã—ã¦ãã ã•ã„ã€‚"
          
          echo "ğŸš€ Starting Pixverse Lipsync Planning Agent Claude Code CLI..."
          echo "ğŸ“ Prompt length: ${#PROMPT}"
          
          # Claude Code CLIã®å®Ÿè¡Œ
          npx @anthropic-ai/claude-code \
            --allowedTools "Read,Write,Edit,Bash" \
            --max-turns 30 \
            --verbose \
            --permission-mode "acceptEdits" \
            -p "$PROMPT" || {
              echo "::error::âŒ Claude Code CLI execution failed"
              exit 1
            }
          
          # ç”Ÿæˆã•ã‚ŒãŸä¼ç”»ã®ç¢ºèªã¨å‡ºåŠ›è¨­å®š
          echo ""
          echo "ğŸ“‹ Checking generated planning files..."
          if [ -d "$PLANNING_DIR" ]; then
            echo "::notice::ğŸ“ Planning directory contents:"
            ls -la "$PLANNING_DIR"
            
            # æ±ºå®šã•ã‚ŒãŸã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°ã‚’èª­ã¿å–ã‚Š
            if [ -f "$PLANNING_DIR/total-segments.txt" ]; then
              TOTAL_SEGMENTS=$(cat "$PLANNING_DIR/total-segments.txt")
              echo "::notice::ğŸ“Š Determined total segments: $TOTAL_SEGMENTS"
              echo "total-segments=$TOTAL_SEGMENTS" >> $GITHUB_OUTPUT
            else
              echo "::error::âŒ total-segments.txt not found"
              exit 1
            fi
            
            # å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®å‡ºåŠ›ã‚’è¨­å®š
            for i in $(seq 1 $TOTAL_SEGMENTS); do
              IMAGE_PROMPT_FILE="$PLANNING_DIR/image-prompt-${i}.txt"
              VIDEO_CONCEPT_FILE="$PLANNING_DIR/video-concept-${i}.txt"
              AUDIO_SCRIPT_FILE="$PLANNING_DIR/audio-script-${i}.txt"
              
              if [ -f "$IMAGE_PROMPT_FILE" ]; then
                IMAGE_PROMPT=$(cat "$IMAGE_PROMPT_FILE" | tr '\n' ' ')
                echo "::notice::ğŸ¨ Image prompt $i: ${IMAGE_PROMPT:0:100}..."
                echo "image-prompt-${i}=$IMAGE_PROMPT" >> $GITHUB_OUTPUT
              else
                echo "::warning::âš ï¸ Image prompt file not found: $IMAGE_PROMPT_FILE"
                echo "image-prompt-${i}=" >> $GITHUB_OUTPUT
              fi
              
              if [ -f "$VIDEO_CONCEPT_FILE" ]; then
                VIDEO_CONCEPT=$(cat "$VIDEO_CONCEPT_FILE" | tr '\n' ' ')
                echo "::notice::ğŸ¬ Video concept $i: ${VIDEO_CONCEPT:0:100}..."
                echo "video-concept-${i}=$VIDEO_CONCEPT" >> $GITHUB_OUTPUT
              else
                echo "::warning::âš ï¸ Video concept file not found: $VIDEO_CONCEPT_FILE"
                echo "video-concept-${i}=" >> $GITHUB_OUTPUT
              fi
              
              if [ -f "$AUDIO_SCRIPT_FILE" ]; then
                AUDIO_SCRIPT=$(cat "$AUDIO_SCRIPT_FILE" | tr '\n' ' ')
                echo "::notice::ğŸ¤ Audio script $i: ${AUDIO_SCRIPT:0:100}..."
                echo "audio-script-${i}=$AUDIO_SCRIPT" >> $GITHUB_OUTPUT
              else
                echo "::warning::âš ï¸ Audio script file not found: $AUDIO_SCRIPT_FILE"
                echo "audio-script-${i}=" >> $GITHUB_OUTPUT
              fi
              
              VOICE_CHARACTER_FILE="$PLANNING_DIR/voice-character-${i}.txt"
              if [ -f "$VOICE_CHARACTER_FILE" ]; then
                VOICE_CHARACTER=$(cat "$VOICE_CHARACTER_FILE" | tr '\n' ' ')
                echo "::notice::ğŸ­ Voice character $i: ${VOICE_CHARACTER:0:100}..."
                echo "voice-character-${i}=$VOICE_CHARACTER" >> $GITHUB_OUTPUT
              else
                echo "::warning::âš ï¸ Voice character file not found: $VOICE_CHARACTER_FILE"
                echo "voice-character-${i}=" >> $GITHUB_OUTPUT
              fi
            done
            
            # ãƒãƒˆãƒªãƒƒã‚¯ã‚¹æˆ¦ç•¥ç”¨ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé…åˆ—ã‚’ä½œæˆ
            SEGMENTS_ARRAY="["
            for i in $(seq 1 $TOTAL_SEGMENTS); do
              if [ $i -gt 1 ]; then
                SEGMENTS_ARRAY="${SEGMENTS_ARRAY},"
              fi
              SEGMENTS_ARRAY="${SEGMENTS_ARRAY}${i}"
            done
            SEGMENTS_ARRAY="${SEGMENTS_ARRAY}]"
            echo "::notice::ğŸ“Š Matrix segments: $SEGMENTS_ARRAY"
            echo "segment-matrix=$SEGMENTS_ARRAY" >> $GITHUB_OUTPUT
            
            echo "completed=true" >> $GITHUB_OUTPUT
            
          else
            echo "::error::âŒ Planning directory not found"
            echo "completed=false" >> $GITHUB_OUTPUT
            exit 1
          fi
          
          echo "::endgroup::"
      
      - name: Commit and push planning
        env:
          GH_TOKEN: ${{ secrets.github_pat }}
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add ${{ inputs.folder-name }}/
          if git diff --cached --quiet; then
            echo "No planning to commit"
          else
            git commit -m "Add Pixverse lipsync planning: ${{ inputs.concept }}
            
            ğŸ¤– Generated with [Claude Code](https://claude.ai/code)
            
            Co-Authored-By: Claude <noreply@anthropic.com>"
            # ä¸¦åˆ—å®Ÿè¡Œã§ã®ç«¶åˆã‚’å›é¿ã™ã‚‹ãŸã‚ã®ãƒªãƒˆãƒ©ã‚¤å‡¦ç†
            for i in {1..3}; do
              git pull --rebase origin ${{ inputs.branch-name }} || true
              if git push origin ${{ inputs.branch-name }}; then
                echo "âœ… Push successful on attempt $i"
                break
              else
                echo "âš ï¸ Push failed on attempt $i, retrying..."
                # ãƒ©ãƒ³ãƒ€ãƒ ãªå¾…æ©Ÿæ™‚é–“ï¼ˆ1-5ç§’ï¼‰
                sleep $((RANDOM % 5 + 1))
              fi
            done
          fi